
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>exercise 6: slicing and masking &#8212; OpenModal Alpha documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     'Alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>%matplotlib inline
import numpy as np
from scipy import misc
from scipy import ndimage
import matplotlib.pyplot as plt
</pre></div>
</div>
</div>
<div class="section" id="exercise-6:-slicing-and-masking">
<h1>exercise 6: slicing and masking<a class="headerlink" href="#exercise-6:-slicing-and-masking" title="Permalink to this headline">¶</a></h1>
<p>Python is the <em>ultimate glue language</em>: Python actually started as a
<strong>glue language</strong> designed to glue other programs together it still does
that better than any computer language. This means it’s possible to mix
and match algorithms in Fortran, Java, C/C++, and yes even MATLAB. C/C++
is particularity easy to integrate with Python. AFRL/RY has lots of
legacy code often written in incompatible languages Canopy makes it
possible <strong>(and even easy)</strong> to mix code bases.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def average(pixel):
    return np.average(pixel)

face = misc.face()
# convert face to grey scale
gray = np.zeros((face.shape[0], face.shape[1]))
for rownum in range(len(face)):
    for colnum in range(len(face[rownum])):
        gray[rownum][colnum] = average(face[rownum, colnum])
gray[100:110, :] = 255 # here is an example of slicing 10 rows and making them white

# we create a mask that is round
lx, ly, lz = face.shape
X, Y = np.ogrid[0:lx, 0:ly]
mask = (X - lx / 2) ** 2 + (Y - ly / 2) ** 2 &gt; lx * ly / 4
gray[mask] = 0
gray[mask] = 0
gray[mask] = 0

plt.gray()
plt.imshow(gray)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_2_0.png" src="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_2_0.png" />
</div>
</div>
</div>
<div class="section" id="exercise-7:-statistical-information">
<h1>exercise 7: statistical information<a class="headerlink" href="#exercise-7:-statistical-information" title="Permalink to this headline">¶</a></h1>
<p>In the example below face is a numpy array (or you can think of it as a
matrix). We are then using NumPy to computer the mean, max, and min. Use
NumPy functions when ever possible because they are faster since they
are written in C and optimized with Intel’s Math Kernel Library (MKL).</p>
<p>Jupyter Notebook Markdown support LaTex equations. Both inline $
e^{i:raw-latex:<cite>pi</cite>} + 1 = 0 $ and equations on their own line:</p>
<div class="math">
\[e^x=\sum_{i=0}^\infty \frac{1}{i!}x^i\]</div>
<p>this is me typing</p>
<p>This expression <span class="math">\(\sqrt{3x-1}+(1+x)^2\)</span> is an example of a TeX
inline equation in a
<a class="reference external" href="http://daringfireball.net/projects/markdown/">Markdown-formatted</a>
sentence (CLICK HERE). If you want to keep your equations, data, and
code all together Jupyter notebooks are for you!! Jupyter notebooks come
out of the Physics community trying to create “Reproducible Science”</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>face = misc.face()
print(&quot;face.mean: %f&quot; % face.mean())
print(&quot;face.max: %f&quot; % face.max())
print(&quot;face.min: %f&quot; % face.min())
plt.hist(face.flatten())
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
face.mean: 110.162744
face.max: 255.000000
face.min: 0.000000
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_4_1.png" src="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_4_1.png" />
</div>
</div>
</div>
<div class="section" id="exercise-9:-geometrical-image-transformations">
<h1>exercise 9: geometrical image transformations<a class="headerlink" href="#exercise-9:-geometrical-image-transformations" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def average(pixel):
    return np.average(pixel)

face = misc.face()
# convert face to gray scale
gray = np.zeros((face.shape[0], face.shape[1]))
for rownum in range(len(face)):
    for colnum in range(len(face[rownum])):
        gray[rownum][colnum] = average(face[rownum, colnum])
face = gray
lx, ly = face.shape
crop_face = face[lx / 4: - lx / 4, ly / 4: - ly /4]
flip_ud_face = np.flipud(face)
rotate_face = ndimage.rotate(face, 45)
rotate_face_noreshape = ndimage.rotate(face, 45, reshape=False)
fig = plt.figure()
fig.suptitle(&#39;face with geometric image transformations&#39;)
faceFigure1 = fig.add_subplot(221)
faceFigure1.imshow(crop_face, cmap=plt.cm.gray)
faceFigure1.axis(&#39;off&#39;)
faceFigure1.set_title(&#39;cropped&#39;)
faceFigure2 = fig.add_subplot(222)
faceFigure2.imshow(flip_ud_face, cmap=plt.cm.gray)
faceFigure2.axis(&#39;off&#39;)
faceFigure2.set_title(&#39;upside down&#39;)
faceFigure3 = fig.add_subplot(223)
faceFigure3.imshow(rotate_face, cmap=plt.cm.gray)
faceFigure3.axis(&#39;off&#39;)
faceFigure3.set_title(&#39;rotate 45&#39;)
faceFigure4 = fig.add_subplot(224)
faceFigure4.imshow(rotate_face_noreshape, cmap=plt.cm.gray)
faceFigure4.axis(&#39;off&#39;)
faceFigure4.set_title(&#39;rotate 45 no reshape&#39;)
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_6_0.png" src="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_6_0.png" />
</div>
</div>
</div>
<div class="section" id="exercise-10:-Multiprocessing-module">
<h1>exercise 10: Multiprocessing module<a class="headerlink" href="#exercise-10:-Multiprocessing-module" title="Permalink to this headline">¶</a></h1>
<p>Most computers these days have more than one processor (aka cores), some
processors even have hyperthreading which doubles the core count. So a 4
core CPU with hyperthreading turned looks like 8 cores to the operating
system. Python has excellent support for multiple cores, one of my
favorite tools for using multiple cores in Python is the
<a class="reference external" href="https://docs.python.org/2/library/multiprocessing.html#managers">Multiprocessing
module</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>import multiprocessing

def worker():
    &quot;&quot;&quot;worker function&quot;&quot;&quot;
    print &#39;Worker&#39;
    return

if __name__ == &#39;__main__&#39;:
    jobs = []
    for i in range(8):
        p = multiprocessing.Process(target=worker)
        jobs.append(p)
        p.start()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Worker
Worker
Worker
Worker
Worker
Worker
Worker
Worker
</pre></div></div>
</div>
<p>Any arguments passed to multiprocessing.Process have to be serizable so
they can be sent to the process. See <a class="reference external" href="https://docs.python.org/2/library/pickle.html#what-can-be-pickled-and-unpickled">The Pickle
Module</a>
for more information. The example below is more useful because it prints
the worker number.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>import multiprocessing

def worker(num):
    &quot;&quot;&quot;thread worker function&quot;&quot;&quot;
    print &#39;Worker:&#39;, num
    return

if __name__ == &#39;__main__&#39;:
    jobs = []
    for i in range(5):
        p = multiprocessing.Process(target=worker, args=(i,))
        jobs.append(p)
        p.start()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Worker: 0
Worker: 1
Worker: 2
Worker: 3
Worker: 4
</pre></div></div>
</div>
<p>The multiprocessing module is powerful and can be used to speed up your
code and use the full power of your computer. Another neat concept in
the multiprocessing module is the Pool.map which is similar to Matlab’s
parfor construct. This method essentially applies a function to each
element in an iterable and returns the results. For example, if I wanted
to square each number in a list of integers between 0 and 9 and perform
the square operation on multiple processors, I would write a function
for squaring an argument, and supply this function and the list of
integers to Pool.map(). The code is below</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>import multiprocessing

def funSquare(num):
    return num ** 2

if __name__ == &#39;__main__&#39;:
    pool = multiprocessing.Pool()
    results = pool.map(funSquare, range(10))
    print(results)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
</pre></div></div>
</div>
<p>Now lets try some real computation by calculating the Mandelbrot set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>import matplotlib.pyplot as plt
import time
from functools import partial

def mandelbrotCalcRow(yPos, h, w, max_iteration = 1000):
    y0 = yPos * (2/float(h)) - 1 #rescale to -1 to 1
    row = []
    for xPos in range(w):
        x0 = xPos * (3.5/float(w)) - 2.5 #rescale to -2.5 to 1
        iteration, z = 0, 0 + 0j
        c = complex(x0, y0)
        while abs(z) &lt; 2 and iteration &lt; max_iteration:
            z = z**2 + c
            iteration += 1
        row.append(iteration)

    return row

def mandelbrotCalcSet(h, w, max_iteration = 1000):
    partialCalcRow = partial(mandelbrotCalcRow, h=h, w=w, max_iteration = max_iteration)
    mandelImg = map(partialCalcRow, xrange(h))
    return mandelImg

if __name__ == &#39;__main__&#39;:
    start_time = time.time()
    mandelImg = mandelbrotCalcSet(800, 800, 2000)
    elapsed_time = time.time() - start_time
    print(&quot;elapsed_time: %s&quot; % str(elapsed_time))
    plt.gray()
    plt.imshow(mandelImg)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
elapsed_time: 54.659222126
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_14_1.png" src="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_14_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>import multiprocessing
import time

def mandelbrotCalcSet(h, w, max_iteration = 1000):
    #make a helper function that better supports pool.map by using only 1 var
    #This is necessary since the version
    partialCalcRow = partial(mandelbrotCalcRow, h=h, w=w, max_iteration = max_iteration)

    pool = multiprocessing.Pool() #creates a pool of process, controls workers
    #the pool.map only accepts one iterable, so use the partial function
    #so that we only need to deal with one variable.
    mandelImg = pool.map(partialCalcRow, xrange(h)) #make our results with a map call
    pool.close() #we are not adding any more processes
    pool.join() #tell it to wait until all threads are done before going on

    return mandelImg
if __name__ == &#39;__main__&#39;:
    start_time = time.time()
    mandelImg = mandelbrotCalcSet(800, 800, 2000)
    elapsed_time = time.time() - start_time
    print(&quot;elapsed_time: %s&quot; % str(elapsed_time))
    plt.gray()
    plt.imshow(mandelImg)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
elapsed_time: 17.2902839184
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_15_1.png" src="../../_images/labnotes_.ipynb_checkpoints_face-checkpoint_15_1.png" />
</div>
</div>
<p>Now switch back over to Sublime and the console for the example with
ctypes.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">exercise 6: slicing and masking</a></li>
<li><a class="reference internal" href="#exercise-7:-statistical-information">exercise 7: statistical information</a></li>
<li><a class="reference internal" href="#exercise-9:-geometrical-image-transformations">exercise 9: geometrical image transformations</a></li>
<li><a class="reference internal" href="#exercise-10:-Multiprocessing-module">exercise 10: Multiprocessing module</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/labnotes/.ipynb_checkpoints/face-checkpoint.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Slovenia Ph.Ds.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../../_sources/labnotes/.ipynb_checkpoints/face-checkpoint.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>